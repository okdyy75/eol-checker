# 実装計画: EOL Timeline Viewer

## 概要

この実装計画は、EOL Timeline Viewerの機能を段階的に構築するための一連のタスクを定義します。各タスクは前のタスクの上に構築され、最終的にすべてのコンポーネントを統合します。

## タスク

- [x] 1. プロジェクトのセットアップと基本構造の構築
  - Next.js 14+プロジェクトを作成（App Router使用）
  - TypeScript、Tailwind CSS、gantt-task-reactをインストール
  - 基本的なディレクトリ構造を作成（app、lib、components、scripts）
  - next.config.jsで静的エクスポートを設定
  - _要件: 6.1, 6.3_

- [x] 2. 型定義とデータモデルの実装
  - [x] 2.1 lib/types.tsに全ての型定義を作成
    - Service、Technology、EOLCycle、EOLProduct、EOLDataMap型を定義
    - GanttTask、GanttLink、GanttScale型を定義
    - URLState型を定義
    - _要件: すべての要件の基盤_

- [x] 3. EOLデータ取得スクリプトの実装
  - [x] 3.1 scripts/fetch-eol-data.tsを作成
    - endoflife.date APIから全製品リストを取得する関数を実装
    - 各製品の詳細サイクル情報を取得する関数を実装
    - データをpublic/data/eol-data.jsonに保存する処理を実装
    - エラーハンドリングとリトライロジックを追加
    - _要件: 2.1, 2.2, 2.3, 2.4_
  
  - [x] 3.2 scripts/__tests__/fetch-eol-data.test.tsを作成
    - APIエラー時のエラーハンドリングをテスト
    - データ保存処理をテスト
    - リトライロジックをテスト
    - _要件: 2.3, 2.4_
  
  - [ ]* 3.3 EOLデータ取得のプロパティテストを作成
    - **プロパティ9: EOLデータフィールドの完全保持**
    - **検証: 要件 2.2, 2.5**
    - 任意のEOLデータに対して、すべてのフィールド（リリース日、サポート終了日、EOL日、LTS情報）が保持されることを確認

- [-] 4. URL状態管理の実装
  - [x] 4.1 lib/url-state.tsを作成
    - セミコロン区切り形式でURLStateをエンコードする関数を実装（`サービス名(技術:バージョン,技術:バージョン);サービス名(技術:バージョン)`）
    - セミコロン区切り文字列をURLStateにデコードする関数を実装
    - 特殊文字（`:`, `;`, `,`, `(`, `)`）のエスケープ処理を実装（`encodeURIComponent`/`decodeURIComponent`）
    - スキーマバリデーション機能を追加
    - エラーハンドリングを実装
    - _要件: 4.1, 4.2, 4.4, 4.5_
  
  - [x] 4.2 lib/__tests__/url-state.test.tsを作成
    - 空のデータセットのエンコード/デコードをテスト
    - 単一サービスのエンコード/デコードをテスト（例: `myapp(python:3.9,nodejs:18.0)`）
    - 複数サービスのエンコード/デコードをテスト（例: `myapp(python:3.9);api(go:1.20)`）
    - 特殊文字を含む名前のエスケープ処理をテスト
    - 不正なフォーマットのデコードエラーをテスト
    - ラウンドトリップテストを実装
    - _要件: 4.3, 4.6_
  
  - [ ]* 4.3 URL状態管理のプロパティテストを作成（ラウンドトリップ）
    - **プロパティ19: URL状態のラウンドトリップ**
    - **検証: 要件 4.6**
    - 任意の有効なサービスデータセットに対して、セミコロン区切り形式でのエンコード→デコードが元のデータを復元することを確認
  
  - [ ]* 4.4 URL状態管理のプロパティテストを作成（エンコード形式）
    - **プロパティ16: URLエンコード形式**
    - **検証: 要件 4.1**
    - 任意のサービスデータセットに対して、URLパラメータがセミコロン区切り形式で正しくエンコードされることを確認
  
  - [ ]* 4.5 URL状態管理のプロパティテストを作成（状態復元）
    - **プロパティ17: 状態復元**
    - **検証: 要件 4.3**
    - 任意のURL状態を含むURLに対して、アプリケーションの状態が正しく復元されることを確認
  
  - [ ]* 4.6 URL状態管理のプロパティテストを作成（特殊文字）
    - **プロパティ18: 特殊文字のエスケープ**
    - **検証: 要件 4.4**
    - 任意の特殊文字を含むサービス名や技術名に対して、適切にエスケープされることを確認

- [x] 5. チェックポイント - 基盤機能の確認
  - すべてのテストが通ることを確認
  - ユーザーに質問があれば確認

- [x] 6. ガントチャートデータ変換ロジックの実装
  - [x] 6.1 lib/gantt-adapter.tsを作成
    - ServiceデータをGanttTask配列に変換する関数を実装
    - 現在バージョンから最新までの関連サイクルを取得する関数を実装（中間バージョンを含む）
    - バージョンがEOL済みかどうかを判定する関数を実装
    - ライフサイクルステージ判定ロジックを実装（4パターン対応：LTS日付あり、supportあり、supportなし、EOL済み）
    - セグメント分割ロジックを実装（current→active→maintenance→eolの色分け）
    - GanttScale配列を生成する関数を実装
    - バーの開始日と終了日がリリース日とEOL日に正確に一致することを保証
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.6, 3.9, 3.10_
  
  - [x] 6.2 lib/__tests__/gantt-adapter.test.tsを作成
    - 単一バージョンの変換をテスト
    - 複数バージョンの変換をテスト（中間バージョンを含む）
    - 存在しない技術名の処理をテスト
    - ライフサイクルステージの判定をテスト（4パターン：LTS日付あり、supportあり、supportなし、EOL済み）
    - セグメント分割の正確性をテスト
    - バーの期間がリリース日とEOL日に正確に一致することをテスト
    - _要件: 3.9, 3.10, 7.2_
  
  - [ ]* 6.3 ガントチャート変換のプロパティテストを作成（全表示）
    - **プロパティ10: 全サービスと技術の表示**
    - **検証: 要件 3.1**
    - 任意のサービスセットに対して、すべてのサービスとそれに含まれるすべての技術が、ガントチャート上に個別の行として表示されることを確認
  
  - [ ]* 6.4 ガントチャート変換のプロパティテストを作成（全バージョン表示）
    - **プロパティ11: 全バージョンの表示**
    - **検証: 要件 3.2, 3.9**
    - 任意の技術とバージョン範囲に対して、現在のバージョンから最新バージョンまでのすべてのバージョンが表示される（中間バージョンを含む）ことを確認
  
  - [ ]* 6.5 ガントチャート変換のプロパティテストを作成（期間の正確性）
    - **プロパティ12: バーの期間の正確性**
    - **検証: 要件 3.3, 3.10**
    - 任意のバージョンに対して、ガントチャートのバーの開始日はリリース日と正確に一致し、終了日はEOL日と正確に一致することを確認
  
  - [ ]* 6.6 ガントチャート変換のプロパティテストを作成（色分け）
    - **プロパティ13: ライフサイクルステージの色分け**
    - **検証: 要件 3.4**
    - 任意のバージョンに対して、そのライフサイクルステージ（current、active、maintenance、eol）に応じて異なる色が適用されることを確認
  
  - [ ]* 6.7 ガントチャート変換のプロパティテストを作成（セグメント表示）
    - **プロパティ14: セグメント表示の正確性**
    - **検証: 要件 3.4**
    - 任意のバージョンに対して、ライフサイクルステージの期間ごとに正しい色でセグメント分割されて表示されることを確認
  
  - [ ]* 6.8 ガントチャート変換のプロパティテストを作成（マーカー表示）
    - **プロパティ15: 現在使用中バージョンのマーカー表示**
    - **検証: 要件 3.5**
    - 任意のサービスと技術に対して、現在使用中のバージョンがガントチャート上でマーカー（★）により明示的に表示されることを確認

- [x] 7. EOLデータ読み込みユーティリティの実装
  - [x] 7.1 lib/eol-data.tsを作成
    - 静的JSONファイルからEOLデータを読み込む関数を実装
    - 特定の技術名でEOLデータを検索する関数を実装
    - データキャッシング機能を追加
    - _要件: 2.4_
  
  - [x] 7.2 lib/__tests__/eol-data.test.tsを作成
    - データ読み込み機能をテスト
    - キャッシング機能をテスト
    - エラーハンドリングをテスト
    - _要件: 2.4_

- [x] 8. 入力バリデーションロジックの実装
  - [x] 8.1 lib/validation.tsを作成
    - サービス名のバリデーション関数を実装
    - 技術名のバリデーション関数を実装
    - バージョン形式のバリデーション関数を実装
    - エラーメッセージ生成関数を実装
    - 柔軟なバリデーション（過剰なバリデーションを避け、可能な限り入力を受け入れる）
    - _要件: 1.5, 7.1_
  
  - [x] 8.2 lib/__tests__/validation.test.tsを作成
    - 空のサービス名の拒否をテスト
    - 空の技術名の拒否をテスト
    - 有効な入力の受け入れをテスト
    - フォーム全体のバリデーションをテスト
    - _要件: 1.5_
  
  - [ ]* 8.3 バリデーションのプロパティテストを作成（不完全データ）
    - **プロパティ20: 不完全データのスキップ処理**
    - **検証: 要件 7.1**
    - 任意の不完全なデータ（技術名やバージョンの欠落）を含むURLに対して、システムは不完全な部分をスキップし、有効なデータのみを表示することを確認
  
  - [ ]* 8.4 バリデーションのプロパティテストを作成（存在しない技術名）
    - **プロパティ21: 存在しない技術名のスキップ**
    - **検証: 要件 7.2**
    - 任意の存在しない技術名を含むデータに対して、システムはその技術をスキップし、他の有効な技術の表示を継続することを確認
  
  - [ ]* 8.5 バリデーションのプロパティテストを作成（エラー時の継続）
    - **プロパティ22: エラー時のアプリケーション継続**
    - **検証: 要件 7.3**
    - 任意のエラー発生時に、システムはユーザーフレンドリーなエラーメッセージを表示し、アプリケーションがクラッシュせずに動作を継続することを確認
  
  - [ ]* 8.6 バリデーションのプロパティテストを作成（XSS防止）
    - **プロパティ23: XSS攻撃の防止**
    - **検証: 要件 7.4**
    - 任意のユーザー入力に対して、適切にエスケープされ、XSS攻撃が防止されることを確認

- [x] 9. TechnologyInputコンポーネントの実装
  - [x] 9.1 components/TechnologyInput.tsxを作成
    - 技術名入力フィールドを実装（オートコンプリート機能付き）
    - バージョン入力フィールドを実装
    - 技術選択時のバージョンサジェスト機能を実装
    - バージョン入力時のフィルタリング機能を実装
    - 削除ボタンを実装
    - バリデーションエラー表示を実装（柔軟な処理）
    - キーボード操作対応を実装（オートコンプリート用）
    - _要件: 1.6, 1.7, 1.8_
  
  - [x] 9.2 components/__tests__/TechnologyInput.test.tsxを作成
    - 入力フィールドのレンダリングをテスト
    - 技術名オートコンプリート機能をテスト
    - バージョンサジェスト機能をテスト
    - バージョンフィルタリング機能をテスト
    - 削除ボタンの動作をテスト
    - キーボード操作をテスト（矢印キー、Enter、Escape）
    - 外部クリックでサジェストを閉じる動作をテスト
    - バリデーションエラーの警告表示をテスト
    - _要件: 1.6, 1.7, 1.8_
  
  - [ ]* 9.3 TechnologyInputコンポーネントのプロパティテストを作成（バージョンリスト）
    - **プロパティ3: バージョンリスト自動表示**
    - **検証: 要件 1.6**
    - 任意の技術名選択時に、その技術の利用可能なバージョンリストが自動的に表示されることを確認
  
  - [ ]* 9.4 TechnologyInputコンポーネントのプロパティテストを作成（フィルタリング）
    - **プロパティ4: バージョン候補フィルタリング**
    - **検証: 要件 1.7**
    - 任意のバージョン入力内容に対して、入力内容を含むバージョン候補のみがフィルタリングされて表示されることを確認

- [x] 10. ServiceFormコンポーネントの実装
  - [x] 10.1 components/ServiceForm.tsxを作成
    - 2カラムレイアウトを実装（左：入力フォーム、右：サービスリスト）
    - サービス名の自動付与機能を実装（service1, service2, service3...の連番形式）
    - サービス追加ボタンを実装
    - 新規サービス追加時に空の技術入力フォームを1つ自動表示
    - サービス削除/選択機能を実装
    - 選択中サービスのハイライト表示を実装（青枠、青背景）
    - サービスリストに技術プレビュー表示を実装（最大3件、それ以上は「+N」表示）
    - サービスが0件の場合の案内メッセージを実装
    - TechnologyInputコンポーネントを統合
    - 技術追加/削除機能を実装
    - リアルタイム自動保存機能を実装（フォーム入力が即座に状態に反映、デバウンスなし）
    - サービスリストとの即時同期表示を実装
    - データクリア機能を実装
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.10, 1.11, 1.12, 1.13, 1.14_
  
  - [x] 10.2 components/__tests__/ServiceForm.test.tsxを作成
    - 2カラムレイアウトのレンダリングをテスト
    - サービス追加時の自動命名をテスト（service1, service2, service3...の連番形式）
    - 新規サービス追加時の空フォーム自動表示をテスト
    - サービス削除/選択をテスト
    - 選択中サービスのハイライト表示をテスト（青枠、青背景）
    - 技術プレビュー表示をテスト（最大3件、それ以上は「+N」表示）
    - 空状態の案内メッセージ表示をテスト（サービスが0件の場合）
    - 技術追加/削除をテスト
    - リアルタイム同期をテスト（デバウンスなしの即時反映）
    - データクリア機能をテスト
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.10, 1.11, 1.12, 1.13, 1.14_
  
  - [ ]* 10.3 ServiceFormコンポーネントのプロパティテストを作成（複数技術）
    - **プロパティ2: 複数技術の追加と保持**
    - **検証: 要件 1.4, 7.6**
    - 任意のサービスに対して、複数の技術を追加した場合、それらすべてが保持され、取得可能であることを確認
  
  - [ ]* 10.4 ServiceFormコンポーネントのプロパティテストを作成（サービス名自動付与）
    - **プロパティ1: サービス名自動付与**
    - **検証: 要件 1.2**
    - 任意の新規サービス追加時に、システムは自動的に service{N} 形式の連番名を付与することを確認
  
  - [ ]* 10.5 ServiceFormコンポーネントのプロパティテストを作成（URL自動更新）
    - **プロパティ5: URL自動更新**
    - **検証: 要件 1.9, 4.2**
    - 任意のデータ変更に対して、URLパラメータが自動的に更新され、変更内容が反映されることを確認
  
  - [ ]* 10.6 ServiceFormコンポーネントのプロパティテストを作成（リアルタイム同期）
    - **プロパティ6: リアルタイム同期**
    - **検証: 要件 1.11**
    - 任意のフォーム入力変更に対して、その変更が即座にサービスリストに反映されることを確認
  
  - [ ]* 10.7 ServiceFormコンポーネントのプロパティテストを作成（ハイライト）
    - **プロパティ7: 選択中サービスのハイライト**
    - **検証: 要件 1.12**
    - 任意のサービス選択に対して、選択中のサービスがサービスリスト上でハイライト表示されることを確認
  
  - [ ]* 10.8 ServiceFormコンポーネントのプロパティテストを作成（技術プレビュー）
    - **プロパティ8: 技術プレビュー表示制限**
    - **検証: 要件 1.13**
    - 任意のサービスに対して、サービスリストに表示される技術プレビューは最大3件までであり、それ以上の技術がある場合は「+N」形式で表示されることを確認

- [x] 11. EOLGanttChartコンポーネントの実装
  - [x] 11.1 components/EOLGanttChart.tsxを作成
    - gantt-task-reactを統合
    - ガントチャートデータ変換ロジックを統合
    - サービスごとの独立したチャート表示を実装
    - 現在バージョンから最新バージョンまでの全バージョンを個別の行として表示（中間バージョンを含む）
    - ライフサイクルステージの色分け表示を実装（current: 緑、active: 青、maintenance: グレー、eol: 赤）
    - セグメント表示を実装（ステージごとに分割）
    - バーの期間がリリース日とEOL日に正確に一致することを保証
    - 現在使用中バージョンのマーカー表示を実装（★）
    - 現在日付の垂直線を表示
    - ツールチップ機能を実装（バージョン番号、リリース日、EOL日、ライフサイクルステージを表示）
    - ライフサイクルステージの凡例表示を実装
    - レスポンシブデザインを実装（水平スクロール対応）
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 3.10, 5.2_
  
  - [x] 11.2 components/__tests__/EOLGanttChart.test.tsxを作成
    - ガントチャートのレンダリングをテスト
    - サービスごとの独立したチャート表示をテスト
    - 全バージョンの表示をテスト（中間バージョンを含む）
    - ライフサイクルステージの色分けをテスト
    - セグメント表示をテスト
    - 現在使用中バージョンのマーカー表示をテスト
    - 現在日付線の表示をテスト
    - ツールチップの表示をテスト
    - 凡例の表示をテスト
    - 空データの処理をテスト
    - _要件: 3.1, 3.2, 3.4, 3.5, 3.7, 3.8, 3.9_

- [x] 12. ErrorBoundaryコンポーネントの実装
  - [x] 12.1 components/ErrorBoundary.tsxを作成
    - React Error Boundaryを実装
    - エラーフォールバックUIを実装
    - エラーログ機能を実装
    - エラータイプ別のメッセージ表示を実装
    - _要件: 7.3, 7.4, 8.4_
  
  - [x] 12.2 components/__tests__/ErrorBoundary.test.tsxを作成
    - エラーキャッチ機能をテスト
    - フォールバックUIの表示をテスト
    - エラータイプ別のメッセージをテスト
    - 再試行機能をテスト
    - _要件: 7.4, 8.4_

- [x] 13. チェックポイント - コンポーネントの確認
  - すべてのコンポーネントテストが通ることを確認
  - ユーザーに質問があれば確認

- [x] 14. メインページの実装
  - [x] 14.1 app/page.tsxを作成
    - 状態管理ロジックを実装（useState、useEffect）
    - URL状態の初期化と同期を実装
    - ServiceFormコンポーネントを統合
    - EOLGanttChartコンポーネントを統合
    - データクリア機能を実装
    - 通知機能を実装
    - エラーハンドリングを実装
    - _要件: 1.9, 4.2, 4.3_
  
  - [ ]* 14.2 メインページの統合テストを作成
    - フォームとチャートの連携をテスト
    - URL状態の同期をテスト
    - _要件: 1.9, 4.2, 4.3_

- [x] 15. レイアウトとスタイリングの実装
  - [x] 15.1 app/layout.tsxを作成
    - ルートレイアウトを実装
    - メタデータ（タイトル、説明）を設定
    - Tailwind CSSのグローバルスタイルをインポート
    - _要件: 5.1_
  
  - [x] 15.2 レスポンシブデザインを実装
    - デスクトップレイアウトを実装
    - タブレットレイアウトを実装
    - モバイルレイアウトを実装
    - 水平スクロール対応を実装
    - _要件: 5.1, 5.2, 5.3_
  
  - [ ]* 15.3 レスポンシブデザインの単体テストを作成
    - 異なる画面サイズでのレイアウトをテスト
    - 水平スクロールの動作をテスト
    - _要件: 5.1, 5.2, 5.3_

- [x] 16. ビルドとデプロイメントの設定
  - [x] 16.1 package.jsonにスクリプトを追加
    - fetch-eol-dataスクリプトを追加
    - buildスクリプトを設定（データ取得→ビルド）
    - testスクリプトを設定
    - _要件: 6.1, 6.2, 6.5_
  
  - [x] 16.2 next.config.jsを最終調整
    - 静的エクスポート設定を確認
    - 画像最適化設定を追加
    - ビルドID生成を設定
    - _要件: 6.1, 6.3_
  
  - [ ]* 16.3 ビルドプロセスの単体テストを作成
    - ビルドが成功することを確認
    - 静的ファイルが正しく生成されることを確認
    - _要件: 6.2, 6.3_

- [x] 17. 最終チェックポイント - 統合テストと動作確認
  - すべてのテストが通ることを確認
  - ローカルでビルドして動作確認
  - ユーザーに質問があれば確認

- [x] 18. ドキュメントの作成
  - [x] 18.1 README.mdを作成
    - プロジェクト概要を記述
    - インストール手順を記述
    - 使用方法を記述
    - ビルドとデプロイ手順を記述
  
  - [ ]* 18.2 CONTRIBUTING.mdを作成（オプション）
    - 開発環境のセットアップ手順を記述
    - テスト実行方法を記述
    - コントリビューションガイドラインを記述

## 注意事項

- `*`マークが付いたタスクはオプションであり、より速いMVPのためにスキップ可能です
- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントは段階的な検証を保証します
- プロパティテストは普遍的な正確性プロパティを検証します
- 単体テストは特定の例とエッジケースを検証します
- すべての必須タスクは完了しており、アプリケーションは完全に機能します
