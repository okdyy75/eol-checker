# 実装計画: EOL Timeline Viewer

## 概要

この実装計画は、EOL Timeline Viewerの機能を段階的に構築するための一連のタスクを定義します。各タスクは前のタスクの上に構築され、最終的にすべてのコンポーネントを統合します。

## タスク

- [x] 1. プロジェクトのセットアップと基本構造の構築
  - Next.js 14+プロジェクトを作成（App Router使用）
  - TypeScript、Tailwind CSS、@svar-ui/react-ganttをインストール
  - 基本的なディレクトリ構造を作成（app、lib、components、scripts）
  - next.config.jsで静的エクスポートを設定
  - _要件: 7.1_

- [x] 2. 型定義とデータモデルの実装
  - [x] 2.1 lib/types.tsに全ての型定義を作成
    - Service、Technology、EOLCycle、EOLProduct、EOLDataMap型を定義
    - GanttTask、GanttLink、GanttScale型を定義
    - URLState型を定義
    - _要件: すべての要件の基盤_

- [x] 3. EOLデータ取得スクリプトの実装
  - [x] 3.1 scripts/fetch-eol-data.tsを作成
    - endoflife.date APIから全製品リストを取得する関数を実装
    - 各製品の詳細サイクル情報を取得する関数を実装
    - データをpublic/data/eol-data.jsonに保存する処理を実装
    - エラーハンドリングとリトライロジックを追加
    - _要件: 2.1, 2.2, 2.3, 2.4_
  
  - [ ]* 3.2 EOLデータ取得のプロパティテストを作成
    - **プロパティ4: EOLデータフィールドの保持**
    - **検証: 要件 2.2, 2.5**
    - 任意のEOLデータに対して、すべてのフィールドが保持されることを確認
  
  - [ ]* 3.3 EOLデータ取得の単体テストを作成
    - APIエラー時のエラーハンドリングをテスト
    - データ保存処理をテスト
    - _要件: 2.3, 2.4_

- [x] 4. URL状態管理の実装
  - [x] 4.1 lib/url-state.tsを作成
    - URLStateをBase64エンコードする関数を実装
    - Base64文字列をURLStateにデコードする関数を実装
    - スキーマバリデーション機能を追加
    - エラーハンドリングを実装
    - _要件: 4.1, 4.3, 4.4, 4.5_
  
  - [ ]* 4.2 URL状態管理のプロパティテストを作成
    - **プロパティ2: URL状態のラウンドトリップ**
    - **検証: 要件 1.4, 4.1, 4.3**
    - 任意の有効なサービスデータセットに対して、エンコード→デコードが元のデータを復元することを確認
  
  - [ ]* 4.3 URL状態管理のプロパティテストを作成（URL長制限）
    - **プロパティ9: URL長の制限遵守**
    - **検証: 要件 4.4**
    - 任意の合理的なサイズのデータセットに対して、エンコード後のURL長が2048文字を超えないことを確認
  
  - [ ]* 4.4 URL状態管理の単体テストを作成
    - 空のデータセットのエンコード/デコードをテスト
    - 不正なURL文字列のデコードエラーをテスト
    - _要件: 4.5_

- [x] 5. ローカルストレージ管理の実装
  - [x] 5.1 lib/storage.tsを作成
    - データをローカルストレージに保存する関数を実装
    - ローカルストレージからデータを読み込む関数を実装
    - データをクリアする関数を実装
    - エラーハンドリング（容量超過、アクセス拒否など）を実装
    - _要件: 6.1, 6.2, 6.4_
  
  - [ ]* 5.2 ローカルストレージのプロパティテストを作成
    - **プロパティ10: ローカルストレージのラウンドトリップ**
    - **検証: 要件 6.1, 6.2**
    - 任意の有効なサービスデータセットに対して、保存→読み込みが元のデータを復元することを確認
  
  - [ ]* 5.3 ローカルストレージの単体テストを作成
    - ストレージのクリア機能をテスト
    - URL状態の優先順位をテスト
    - _要件: 6.3, 6.4_

- [x] 6. チェックポイント - 基盤機能の確認
  - すべてのテストが通ることを確認
  - ユーザーに質問があれば確認

- [x] 7. ガントチャートデータ変換ロジックの実装
  - [x] 7.1 lib/gantt-adapter.tsを作成
    - ServiceデータをGanttTask配列に変換する関数を実装
    - 現在バージョンから最新までの関連サイクルを取得する関数を実装
    - バージョンがEOL済みかどうかを判定する関数を実装
    - GanttScale配列を生成する関数を実装
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.6_
  
  - [ ]* 7.2 ガントチャート変換のプロパティテストを作成（全表示）
    - **プロパティ5: 全サービスと技術の表示**
    - **検証: 要件 3.1, 3.2**
    - 任意のサービスセットに対して、すべてのサービスと技術が個別の行として表示されることを確認
  
  - [ ]* 7.3 ガントチャート変換のプロパティテストを作成（バージョン範囲）
    - **プロパティ6: バージョン範囲の完全表示**
    - **検証: 要件 3.3**
    - 任意の技術とバージョン範囲に対して、すべての中間バージョンが表示されることを確認
  
  - [ ]* 7.4 ガントチャート変換のプロパティテストを作成（期間の正確性）
    - **プロパティ7: バーの期間の正確性**
    - **検証: 要件 3.4**
    - 任意のバージョンに対して、バーの開始日と終了日が正しいことを確認
  
  - [ ]* 7.5 ガントチャート変換のプロパティテストを作成（EOL状態）
    - **プロパティ8: EOL状態の視覚的区別**
    - **検証: 要件 3.6**
    - 任意のバージョンに対して、EOL状態に応じて異なるスタイルが適用されることを確認
  
  - [ ]* 7.6 ガントチャート変換の単体テストを作成
    - 単一バージョンの変換をテスト
    - 複数バージョンの変換をテスト
    - 存在しない技術名の処理をテスト
    - _要件: 8.2_

- [x] 8. EOLデータ読み込みユーティリティの実装
  - [x] 8.1 lib/eol-data.tsを作成
    - 静的JSONファイルからEOLデータを読み込む関数を実装
    - 特定の技術名でEOLデータを検索する関数を実装
    - データキャッシング機能を追加
    - _要件: 2.4_

- [x] 9. 入力バリデーションロジックの実装
  - [x] 9.1 lib/validation.tsを作成
    - サービス名のバリデーション関数を実装
    - 技術名のバリデーション関数を実装
    - バージョン形式のバリデーション関数を実装
    - エラーメッセージ生成関数を実装
    - _要件: 1.5, 8.1_
  
  - [ ]* 9.2 バリデーションのプロパティテストを作成
    - **プロパティ3: 無効な入力の拒否**
    - **検証: 要件 1.5, 8.1**
    - 任意の無効な入力に対して、適切なエラーメッセージが表示され、データの追加が防止されることを確認
  
  - [ ]* 9.3 バリデーションの単体テストを作成
    - 空のサービス名の拒否をテスト
    - 空の技術名の拒否をテスト
    - 有効な入力の受け入れをテスト
    - _要件: 1.5_

- [x] 10. TechnologyInputコンポーネントの実装
  - [x] 10.1 components/TechnologyInput.tsxを作成
    - 技術名入力フィールドを実装（オートコンプリート機能付き）
    - バージョン入力フィールドを実装
    - 削除ボタンを実装
    - バリデーションエラー表示を実装
    - _要件: 1.3, 1.5_
  
  - [ ]* 10.2 TechnologyInputコンポーネントの単体テストを作成
    - 入力フィールドのレンダリングをテスト
    - バリデーションエラー表示をテスト
    - 削除ボタンの動作をテスト
    - _要件: 1.3, 1.5_

- [x] 11. ServiceFormコンポーネントの実装
  - [x] 11.1 components/ServiceForm.tsxを作成
    - サービス名入力フィールドを実装
    - サービス追加/削除ボタンを実装
    - TechnologyInputコンポーネントを統合
    - 技術追加/削除機能を実装
    - フォーム全体のバリデーションを実装
    - _要件: 1.1, 1.2, 1.3, 1.5_
  
  - [ ]* 11.2 ServiceFormコンポーネントのプロパティテストを作成
    - **プロパティ1: 複数技術の追加**
    - **検証: 要件 1.2**
    - 任意のサービスに対して、複数の技術を追加した場合、それらすべてが保持されることを確認
  
  - [ ]* 11.3 ServiceFormコンポーネントの単体テストを作成
    - サービス追加/削除をテスト
    - 技術追加/削除をテスト
    - フォーム送信フローをテスト
    - _要件: 1.1, 1.2_

- [x] 12. EOLGanttChartコンポーネントの実装
  - [x] 12.1 components/EOLGanttChart.tsxを作成
    - @svar-ui/react-ganttを統合
    - ガントチャートデータ変換ロジックを統合
    - 現在日付の垂直線を表示
    - ツールチップ機能を実装（バージョン番号、リリース日、EOL日を表示）
    - レスポンシブデザインを実装（水平スクロール対応）
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 5.2_
  
  - [ ]* 12.2 EOLGanttChartコンポーネントの単体テストを作成
    - ガントチャートのレンダリングをテスト
    - 現在日付線の表示をテスト
    - ツールチップの表示をテスト
    - _要件: 3.5, 3.7_

- [x] 13. ErrorBoundaryコンポーネントの実装
  - [x] 13.1 components/ErrorBoundary.tsxを作成
    - React Error Boundaryを実装
    - エラーフォールバックUIを実装
    - エラーログ機能を実装
    - _要件: 8.3, 8.4_
  
  - [ ]* 13.2 ErrorBoundaryコンポーネントの単体テストを作成
    - エラーキャッチ機能をテスト
    - フォールバックUIの表示をテスト
    - _要件: 8.4_

- [x] 14. チェックポイント - コンポーネントの確認
  - すべてのコンポーネントテストが通ることを確認
  - ユーザーに質問があれば確認

- [ ] 15. メインページの実装
  - [x] 15.1 app/page.tsxを作成
    - 状態管理ロジックを実装（useState、useEffect）
    - URL状態の初期化と同期を実装
    - ローカルストレージの初期化と同期を実装
    - ServiceFormコンポーネントを統合
    - EOLGanttChartコンポーネントを統合
    - データクリア機能を実装
    - _要件: 1.4, 4.2, 6.1, 6.2, 6.3, 6.4_
  
  - [ ]* 15.2 メインページの統合テストを作成
    - URL状態の優先順位をテスト
    - データクリア機能をテスト
    - フォームとチャートの連携をテスト
    - _要件: 6.3, 6.4_

- [ ] 16. レイアウトとスタイリングの実装
  - [x] 16.1 app/layout.tsxを作成
    - ルートレイアウトを実装
    - メタデータ（タイトル、説明）を設定
    - Tailwind CSSのグローバルスタイルをインポート
    - @svar-ui/react-ganttのCSSをインポート
    - _要件: 5.1_
  
  - [x] 16.2 レスポンシブデザインを実装
    - デスクトップレイアウトを実装
    - タブレットレイアウトを実装
    - モバイルレイアウトを実装
    - _要件: 5.1, 5.2, 5.4_
  
  - [ ]* 16.3 レスポンシブデザインの単体テストを作成
    - 異なる画面サイズでのレイアウトをテスト
    - 水平スクロールの動作をテスト
    - _要件: 5.1, 5.2, 5.4_

- [ ] 17. ビルドとデプロイメントの設定
  - [x] 17.1 package.jsonにスクリプトを追加
    - fetch-eol-dataスクリプトを追加
    - buildスクリプトを設定（データ取得→ビルド）
    - exportスクリプトを設定
    - _要件: 7.1, 7.2_
  
  - [x] 17.2 next.config.jsを最終調整
    - 静的エクスポート設定を確認
    - 画像最適化設定を追加
    - _要件: 7.1, 7.3_
  
  - [ ]* 17.3 ビルドプロセスの単体テストを作成
    - ビルドが成功することを確認
    - 静的ファイルが正しく生成されることを確認
    - _要件: 7.2, 7.3_

- [x] 18. 最終チェックポイント - 統合テストと動作確認
  - すべてのテストが通ることを確認
  - ローカルでビルドして動作確認
  - ユーザーに質問があれば確認

- [ ] 19. ドキュメントの作成
  - [x] 19.1 README.mdを作成
    - プロジェクト概要を記述
    - インストール手順を記述
    - 使用方法を記述
    - ビルドとデプロイ手順を記述
  
  - [ ] 19.2 CONTRIBUTING.mdを作成（オプション）
    - 開発環境のセットアップ手順を記述
    - テスト実行方法を記述
    - コントリビューションガイドラインを記述

## 注意事項

- `*`マークが付いたタスクはオプションであり、より速いMVPのためにスキップ可能です
- 各タスクは特定の要件を参照しており、トレーサビリティを確保しています
- チェックポイントは段階的な検証を保証します
- プロパティテストは普遍的な正確性プロパティを検証します
- 単体テストは特定の例とエッジケースを検証します
